---
title: Tidy Text Mining
author: Yuan Du
date: '2019-07-18'
slug: tidy-text-mining
categories:
  - R
tags:
  - Tidytext
---
Thanks to the short course at SDSS 2019, I learned how to do tf-idf to topic modeling and sentiment analysis by using tidytext taught by Julia Silge, author of [Text Mining with R](https://www.tidytextmining.com/) and Mara Averick. They did a great job on teaching the four hour class. I didn't expect to have so much covered in the short course. 

Here is an example that I used the method to analyze **A Tale of Two Cities** and **Great Expectations** by Charles Dickens by using sentiment analysis.

#Installation

`install.packages("tidytext")`

#Read the book from gutenbergr package, after install gutenbergr package

We can Downloading books by ID (98) from [Project Gutenbergr](http://www.gutenberg.org/).

```{r read, echo=TRUE}

library(gutenbergr)
library(dplyr)

book <-  gutenberg_download(c(98, 1400), meta_fields = "title") %>%
  group_by(title) %>%
  mutate(line = row_number()) %>%
  ungroup()

book

```
#Process books into chapters and words in tidy data form

we need to restructure it as one-token-per-row format. As pre-processing, we divide these into chapters, use tidytext’s `unnest_tokens` to separate them into words, then remove `stop_word`s. We’re treating every chapter as a separate “document”, each with a name like *A Tale of Two cities* or *Great Expectations*.
```{r unnest}
library(tidytext)
tidy_book <- book %>%
  unnest_tokens(word, text)

tidy_book


tidy_book <- tidy_book %>%
  anti_join(get_stopwords())

#We can also use count to find the most common words in all the book as a whole
tidy_book %>%
  count(word, sort = TRUE)
```

#Sentiment analysis

Sentiment analysis can be done as an inner join. Three sentiment lexicons are available via the `get_sentiments()` function. Let's examine how sentiment changes during each novel. Let's find a sentiment score for each word using the Bing lexicon, then count the number of positive and negative words in defined sections of each novel.

```{r, message=FALSE}
library(tidyr)
get_sentiments("bing")

sentiment <- tidy_book %>%
  inner_join(get_sentiments("bing"), by = "word") %>% 
  count(title, index = line %/% 80, sentiment) %>% 
  spread(sentiment, n, fill = 0) %>% 
  mutate(sentiment = positive - negative)

sentiment
```

#Now we can plot these sentiment scores across the plot trajectory of each novel.
```{r, message=FALSE}
library(ggplot2)

ggplot(sentiment, aes(index, sentiment, fill = title)) +
  geom_bar(stat = "identity", show.legend = FALSE) +
  facet_wrap(~title, ncol = 2, scales = "free_x")
```
#Now we are ready to use the topicmodels package to create a two topic LDA model.
It looks like that **A Table of Two Cities** has more negative emotions and **Great Expectations** is more balanced on emotions.


_Working on it_